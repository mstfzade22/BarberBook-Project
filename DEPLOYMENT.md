# üöÄ Deployment Guide - Render CI/CD

This guide explains how to deploy both the frontend and backend of BarberBook to Render with automatic CI/CD.

## üìã Prerequisites

1. **GitHub Repository**: Your code must be in a GitHub repository
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Environment Variables**: Prepare your production secrets

---

## üîß Deployment Steps

### Option 1: Using Render Blueprint (Recommended)

This method deploys both frontend and backend automatically using the `render.yaml` file.

#### Step 1: Connect Your Repository

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** ‚Üí **"Blueprint"**
3. Connect your GitHub account if not already connected
4. Select your **BarberBook-Project** repository
5. Click **"Connect"**

#### Step 2: Configure Services

Render will automatically detect the `render.yaml` file and show:

- **barberbook-backend** (Web Service)
- **barberbook-frontend** (Static Site)

#### Step 3: Set Environment Variables

For the backend service, Render will prompt you to set:

- `JWT_SECRET` - Will be auto-generated (or set your own)
- Other variables are pre-configured in `render.yaml`

#### Step 4: Deploy

1. Click **"Apply"**
2. Render will:
   - Create both services
   - Install dependencies
   - Deploy your application
   - Set up automatic deployments on git push

#### Step 5: Get Your URLs

After deployment completes:

- **Backend API**: `https://barberbook-backend.onrender.com`
- **Frontend**: `https://barberbook-frontend.onrender.com`

---

### Option 2: Manual Deployment (Alternative)

If you prefer to set up services manually:

#### Backend Deployment

1. **Create New Web Service**

   - Click **"New"** ‚Üí **"Web Service"**
   - Connect your repository
   - Configure:
     - **Name**: `barberbook-backend`
     - **Region**: Oregon (or closest to users)
     - **Branch**: `main`
     - **Root Directory**: `BarberBook-Backend`
     - **Environment**: `Node`
     - **Build Command**: `npm install`
     - **Start Command**: `npm start`
     - **Plan**: Free

2. **Environment Variables**

   ```
   NODE_ENV=production
   PORT=10000
   JWT_SECRET=<auto-generated-secret>
   JWT_EXPIRES_IN=7d
   FRONTEND_URL=https://barberbook-frontend.onrender.com
   ```

3. **Advanced Settings**
   - Health Check Path: `/health`
   - Auto-Deploy: Yes

#### Frontend Deployment

1. **Create New Static Site**

   - Click **"New"** ‚Üí **"Static Site"**
   - Connect your repository
   - Configure:
     - **Name**: `barberbook-frontend`
     - **Region**: Oregon
     - **Branch**: `main`
     - **Root Directory**: Leave empty (root)
     - **Publish Directory**: `BarberBook`
     - **Build Command**: Leave empty

2. **Create `BarberBook/config.js`** (if needed)

   ```javascript
   window.API_URL = "https://barberbook-backend.onrender.com";
   ```

3. **Update your frontend files**
   Replace hardcoded API URLs with `window.API_URL` or the backend URL

---

## üîÑ Automatic CI/CD

Once deployed, Render will automatically:

‚úÖ **Detect new commits** to your `main` branch  
‚úÖ **Build and deploy** both frontend and backend  
‚úÖ **Run health checks** to ensure services are working  
‚úÖ **Rollback** if deployment fails  
‚úÖ **Send notifications** about deployment status

### Triggering Deployments

Simply push to your main branch:

```bash
git add .
git commit -m "Update feature"
git push origin main
```

Render will automatically deploy within 1-2 minutes.

---

## üîç Monitoring & Logs

### View Logs

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click on your service (backend or frontend)
3. Navigate to **"Logs"** tab
4. View real-time deployment and runtime logs

### Health Checks

Backend health endpoint: `https://barberbook-backend.onrender.com/health`

Expected response:

```json
{
  "success": true,
  "message": "BarberBook API is running",
  "timestamp": "2025-12-11T..."
}
```

---

## ‚öôÔ∏è Configuration Files

### `render.yaml` Structure

```yaml
services:
  - Backend Web Service (Node.js)
  - Frontend Static Site (HTML/CSS/JS)
```

Both services have:

- Automatic deployment enabled
- Health checks configured
- Environment variables set
- CORS and security headers

---

## üêõ Troubleshooting

### Backend Issues

**Problem**: Backend not starting

- **Check**: Logs for errors
- **Verify**: Environment variables are set
- **Ensure**: `package.json` start script is correct

**Problem**: CORS errors

- **Update**: `FRONTEND_URL` environment variable with actual frontend URL
- **Redeploy**: Backend service

### Frontend Issues

**Problem**: API calls failing

- **Check**: Frontend is using correct backend URL
- **Verify**: Backend is running and accessible
- **Update**: API URL in frontend configuration

**Problem**: 404 on routes

- **Verify**: `render.yaml` has rewrite rules for SPA routing

### Free Tier Limitations

‚ö†Ô∏è **Important**: Render's free tier has limitations:

- Services spin down after 15 minutes of inactivity
- First request after spin-down takes 30-60 seconds
- 750 hours/month free (sufficient for 1-2 services)

---

## üîê Security Best Practices

1. **Never commit** `.env` files with secrets
2. **Use** Render's secret management for `JWT_SECRET`
3. **Enable** HTTPS (automatic on Render)
4. **Set** security headers (configured in `render.yaml`)
5. **Rotate** JWT secrets periodically

---

## üìö Additional Resources

- [Render Documentation](https://render.com/docs)
- [Render Blueprint Specification](https://render.com/docs/blueprint-spec)
- [Node.js on Render](https://render.com/docs/deploy-node-express-app)
- [Static Sites on Render](https://render.com/docs/static-sites)

---

## üéØ Next Steps

1. ‚úÖ Deploy using Blueprint
2. ‚úÖ Test all API endpoints
3. ‚úÖ Update frontend with production API URL
4. ‚úÖ Test full booking flow
5. ‚úÖ Monitor logs and performance
6. üîÑ Push updates to trigger auto-deployment

---

**Need help?** Check Render's logs or contact support at [render.com/support](https://render.com/support)
